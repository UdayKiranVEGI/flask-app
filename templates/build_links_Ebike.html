<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Bike Releases</title>
    <style>
        /* Basic Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
 
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f6f9;
            color: #333;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }
 
        h1 {
            text-align: center;
            color: #1e90ff;
            margin-bottom: 40px;
            font-size: 2.5rem;
            font-weight: bold;
        }
 
        /* .container {
            max-width: 1200px;
            margin: 0 auto;
        } */
         /* Responsive Container */
        .container {
            max-width: 95%; /* Dynamically adjust width */
            margin: 0 auto;
        }
 
        .section {
            margin-bottom: 30px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 20px;
            transition: all 0.3s ease-in-out;
        }
 
        .section:hover {
            transform: scale(1.02);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
 
        h2 {
            color: #fff;
            font-size: 1.8rem;
            padding: 15px;
            text-align: center;
            background: linear-gradient(90deg, #007bff, #00d4ff);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
 
        h2.active {
            background: linear-gradient(90deg, #00d4ff, #007bff); /* Active color */
        }
 
        h2:hover {
            background: linear-gradient(90deg, #0056b3, #00d4ff);
        }
 
        h3 {
            color: #1e90ff;
            font-size: 1.5rem;
            margin: 20px 0 10px;
            font-weight: bold;
            cursor: pointer;
            border-bottom: 2px solid #1e90ff;
            padding-bottom: 5px;
        }
 
        h3.active {
            color: #007bff;
        }
 
        h4 {
            color: #007bff;
            font-size: 1.3rem;
            margin: 15px 0;
            font-weight: bold;
        }
 
        .module-container {
            display: none;
            margin-top: 15px;
            padding-left: 20px;
        }
 
        /* .table-container {
            margin-top: 20px;
            overflow-x: auto;
            border-radius: 8px;
        }
 
        table {
            width: 100%;
            border-collapse: collapse;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s ease-in-out; 
        } */

        /* Tables */
        .table-container {
            overflow-x: auto; /* Horizontal scrolling for small screens */
            margin-top: 10px;
            border-radius: 8px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
            font-size: 0.9rem; /* Adjust for responsiveness */
        }
 
        th, td {
            padding: 12px 15px;
            text-align: left;
            border: 1px solid #ddd;
        }
 
        th {
            background-color: #007bff;
            color: white;
            font-size: 1.1rem;
        }
 
        td {
            background-color: #f9f9f9;
        }
 
        td a {
            color: #007bff;
            text-decoration: none;
            font-weight: bold;
        }
 
        td a:hover {
            text-decoration: underline;
        }
 
        tbody tr:hover {
            background-color: #f1f1f1;
        }
        button {
            background-color: #bbb;
            font-size: 0.8emrem; /* Relative font size */
            padding: 0.5em 1em; /* Responsive padding */
            border-radius: 12px;
            cursor: pointer;
            display: inline-block; /* Ensures proper alignment */
            text-align: center; /* Center-aligns text */
            width: auto; /* Allows button to resize based on content */
            max-width: 100%; /* Prevents overflow */
            box-sizing: border-box; /* Ensures padding is included in the width */
        }
        
        /* Optional: Hover effect */
        button:hover {
            background-color: #aaa;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-height: 80%;
            overflow-y: auto;
            position: relative; /* Allow absolute positioning of the close button inside this */
        }
        
        .close {
            position: absolute; /* Position inside the modal-content */
            top: 10px; /* Distance from the top of the modal */
            right: 10px; /* Distance from the right of the modal */
            cursor: pointer;
            font-size: 40px;
            z-index: 9999; /* Ensure the close button stays above the content */
        }
        
        .pr-item {
            white-space: pre-wrap; /* Preserve line breaks and spacing for large content */
            font-family: Arial, sans-serif; /* Ensure readable text */
            font-size: 14px;
        }

        /* Responsive Adjustments */
@media (max-width: 768px) {
    button {
        font-size: 1.5rem; /* Smaller font size */
        padding: 1.2em 1.2em; /* Reduced padding */
    }
    
    h1 {
        font-size: 1.8rem; /* Reduce font size */
    }
 
    h2 {
        font-size: 1.2rem;
        padding: 8px;
    }
 
    h3 {
        font-size: 1rem;
    }
 
    h4 {
        font-size: 0.9rem;
    }
 
    table {
        font-size: 0.8rem; /* Adjust table font size */
    }
}
 
@media (max-width: 480px) {
    button {
        font-size: 0.8rem; /* Smaller font size */
        padding: 0.4em 0.8em; /* Reduced padding */
    }
    
    h1 {
        font-size: 1.5rem;
    }
 
    h2 {
        font-size: 1rem;
    }
}
 
    </style>
</head>
<body>
 
    <h1>E-Bike Releases</h1>
 
    <div class="container" id="build-data"></div>
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <div id="modal-content"></div>
        </div>
    </div>

    <script>
        // Fetch the JSON data from the file
        fetch('/get-EBike-json')
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                renderData(data);
            })
            .catch(error => {
                console.error('Error loading JSON data:', error);
            });

        function renderData(data) {
            const container = document.getElementById('build-data');

            Object.keys(data).forEach(branch => {
                const branchDiv = document.createElement('div');
                branchDiv.classList.add('section');
                branchDiv.id = branch;
                branchDiv.innerHTML = `<h2 onclick="toggleBranch('${branch}')">${branch}</h2>`;
                container.appendChild(branchDiv);

                const branchModulesDiv = document.createElement('div');
                branchModulesDiv.classList.add('module-container');
                branchDiv.appendChild(branchModulesDiv);

                Object.keys(data[branch]).forEach(module => {
                    const moduleDiv = document.createElement('div');
                    moduleDiv.classList.add('submodule-container');
                    moduleDiv.innerHTML = `<h3 onclick="toggleModule('${branch}-${module}')">${module}</h3>`;
                    branchModulesDiv.appendChild(moduleDiv);

                    const moduleContainerDiv = document.createElement('div');
                    moduleContainerDiv.id = `${branch}-${module}`;
                    moduleContainerDiv.classList.add('module-container');
                    renderSubmodules(module, data[branch][module], moduleContainerDiv);
                    moduleDiv.appendChild(moduleContainerDiv);
                });
            });
        }

        function renderSubmodules(module, links, parentDiv) {
            const tableRules = {
                DOL_MOTORS_YP: [
                    { title: "DOL_MOTORS_YP Builds", range: [0, links.length - 1] }
                ],
                AURIGA_BP: [
                    { title: "AURIGA_BP Builds", range: [0, links.length - 1] }
                ],
                AURIGA_YP: [
                    { title: "AURIGA_YP Builds", range: [0, links.length - 1] }
                ]  
            };

            const rules = tableRules[module];
            if (!rules) return;

            rules.forEach(rule => {
                const { title, range } = rule;
                const [start, end] = range;

                const tableDiv = document.createElement('div');
                tableDiv.innerHTML = ` 
                    <h4>${title}</h4>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Build Name</th>
                                    <th>Artifacts</th>
                                    <th>HMIC APKs</th>
                                    <th>Android APKs</th>
                                    <th>IOS APKs</th>
                                    <th>Date_Time</th>
                                    <th>Merged Gerrit Commits</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                `;
                parentDiv.appendChild(tableDiv);

                const tbody = tableDiv.querySelector('tbody');

                links.slice(start, end + 1).forEach(item => {
                    const [url, Name, ...details] = item; // Destructure `item` to get URL, Name, and remaining details.
                
                    details.forEach((innerdetails, index) => {
                        const row = document.createElement('tr'); // Create a new row for each set of inner details.
                        const [Build_Name, Artifacts_link, HMIC_APK_link, Android_APK_link, IOS_APK, dateTime, prList] = innerdetails; // Destructure each inner details array.
                        row.innerHTML = `
                                <td><a href="${url}" target="_blank">${Build_Name}</a></td>
                                <td><a href="${Artifacts_link}" target="_blank">${ "Download-Artifact" || "N/A"}</a></td>
                                <td><a href="${HMIC_APK_link}" target="_blank">${"HMIC-APK" || "N/A"}</a></td>
                                <td><a href="${Android_APK_link}" target="_blank">${"Android-APK" || "N/A"}</a></td>
                                <td>${ IOS_APK || "N/A"}</td>
                                <td>${dateTime || "N/A"}</td>
                                <td><button onclick='openModal(${JSON.stringify(prList)
                                    .replace(/&/g, "&amp;")  // Escape ampersands
                                    .replace(/</g, "&lt;")   // Escape less-than signs
                                    .replace(/>/g, "&gt;")   // Escape greater-than signs
                                    .replace(/'/g, "&apos;") // Escape single quotes
                                    .replace(/"/g, "&quot;") // Escape double quotes
                                    .replace(/\\/g, "\\\\")   // Escape backslashes
                                    .replace(/\n/g, "\\n")    // Escape newlines
                                    .replace(/\r/g, "\\r")    // Escape carriage returns
                                    .replace(/\t/g, "&#9;")    // Escape tabs
                                })'>Release Note</button></td>
                            `;
                
                        tbody.appendChild(row); // Append the row to the table body.
                    });
                });
            });
        }
        function toggleBranch(branchId) {
            const allSections = document.querySelectorAll('.section');
            const branch = document.getElementById(branchId);
        
            // Close all other branches
            allSections.forEach(section => {
                if (section !== branch) {
                    section.querySelector('.module-container').style.display = 'none';
                    section.querySelector('h2').classList.remove('active');
                }
            });
        
            // Toggle the selected branch
            const branchModules = branch.querySelector('.module-container');
            branchModules.style.display = branchModules.style.display === 'block' ? 'none' : 'block';
            branch.querySelector('h2').classList.toggle('active');
        }
        
        function toggleModule(moduleId) {
            const module = document.getElementById(moduleId);
            const parent = module.parentElement.parentElement;
        
            // Close all sibling modules
            parent.querySelectorAll('.module-container').forEach(sibling => {
                if (sibling !== module) {
                    sibling.style.display = 'none';
                    sibling.previousElementSibling.classList.remove('active');
                }
            });
        
            // Toggle the selected module
            module.style.display = module.style.display === 'block' ? 'none' : 'block';
            module.previousElementSibling.classList.toggle('active');
        }
        function openModal(prList) {
            const modal = document.getElementById('modal');
            const contentDiv = document.getElementById('modal-content');
        
            // Clear previous content
            contentDiv.innerHTML = '';
        
            // Add PRs to modal content
            if (prList) {
                const prItem = document.createElement('div');
                prItem.innerHTML = prList; // Use innerHTML to correctly display the HTML content
                prItem.classList.add('pr-item');
                contentDiv.appendChild(prItem);
            } else {
                contentDiv.textContent = 'No PRs available';
            }
        
            modal.style.display = 'flex';
        }
                

        function closeModal() {
            const modal = document.getElementById('modal');
            modal.style.display = 'none';
        }
        
        
    </script>
</body>
</html>
